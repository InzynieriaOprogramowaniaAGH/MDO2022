pipeline {
    agent any
    stages {
        stage('Build') { 
            steps {
                sh'''
                cd GCL/03/JZ307699/Lab_4
                docker build -t easy/sauce:latest .
                cd Dockerfile2
                docker build -t easy/sauce2:latest .
                '''
            }
            post {
                success {
                    echo 'I succeeded!'
                    //archiveArtifacts artifacts: 'Build/libs/**/*.jar'
                    mail to: 'juligabi@tlen.pl',
                      subject: "Successful Pipeline",
                      body: "Wszystko gra w Build. :)"
                }
                failure {
                    echo 'I failed :('
                    mail to: 'juligabi@tlen.pl',
                        subject: "Failed Pipeline",
                        body: "Coś poszło nie tak w Build. :("
                }
            }
        }
        stage('Test') { 
            steps {
                sh '''
                docker run easy/sauce2:latest
                '''
            }
            post {
            success {
                echo 'I succeeded!'
                mail to: 'juligabi@tlen.pl',
                    subject: "Successful Pipeline: ${currentBuild.fullDisplayName}",
                    body: "Wszystko gra w Test. :)"
            }

            failure {
                echo 'I failed :('
                mail to: 'juligabi@tlen.pl',
                    subject: "Failed Pipeline: ${currentBuild.fullDisplayName}",
                    body: "Coś poszło nie tak w Test. :("
            }
          }
        }
        stage('Deploy'){
            steps {
                //docker.withRegistry('https://registry.hub.docker.com', 'docker-hub-credentials') {
                //push("${env.BUILD_NUMBER}")
                //push("easy/sauce:latest")
                withCredentials([usernamePassword(
                credentialsId: 'ARTIFACTORY_CREDENTIALS', 
                passwordVariable: 'ARTI_PASSWD', 
                usernameVariable: 'ARTI_USERNAME')]) {
           script {
             sh 'deploy command with ${ARTI_USERNAME} and ${ARTI_PASSWD}'
           }
                    
            }
         }
        }
    }
}
